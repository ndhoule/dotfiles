#!/usr/bin/env bash

#
# Install (Neo/)Vim dotfiles.
#
# Authors:
#   Nathan Houle <nathan@nathanhoule.com>
#
# TODO: Handle existing .{vim,nvim} symlinks gracefully
#

set -o nounset
set -o errexit

#
# Directories.
#

PWD=$(dirname $(greadlink -f "${BASH_SOURCE[0]}"))

#
# Load dependencies.
#

source "$(dirname $PWD)/.lib/utils.sh"

#
# Symlink a file to a location and echo output.
#
# $1 <string> source
# $2 <string> dest
#

symlink() {
  local source=$1
  local dest=$2

  log_info "Linking ${source} to ${dest}..."

  if [[ -e $dest ]]; then
    fatal "Can't symlink, ${dest} already exists." || exit $?
  fi

  ln -s "${source}" "${dest}"
}

#
# Main.
#

_install() {
  log_info "Setting up vim..."

  symlink $PWD "${HOME}/.vim"
  symlink $PWD "${HOME}/.nvim"

  log_info "Finished setting up vim."
}

#
# Catch failures and warn the user.
#

fail() {
  log_error "Failed to set up Vim."
}

trap fail 0

#
# Boot.
#

(_install)
